# IPP_work-study

## 1. [파이토치 튜토리얼](https://github.com/KangHongJun/IPP_Xiilab/tree/main/pytorch)

### 진행과정
 [pytorch 튜툐리얼](https://tutorials.pytorch.kr/beginner/basics/quickstart_tutorial.html)을 Pycharm환경에서 conda 인터프리터로 설정하여 진행했다. 

2021년도에 한국IT비즈니스진흥협회에서 고급 딥러닝 과정을 들었기에 용어가 친숙했지만, 까먹은 상태였기 때문에 용어와 함수들의 의미에 대해 인지하는 시간이었다.

#### 느낀점
 용어와 함수의 기능과 흐름만을 이해하면서 진행했다보니 이론적인 부분이나 그렇게 되는 이유까지는 알 수 없었기 때문에 수학이나 이론적인 부분에 대한 공부의 필요성을 느꼈다.


## 2. [yolov5를 이용한 재난 감지](https://github.com/KangHongJun/IPP_Xiilab/tree/main/collapse_data_train)

### 진행과정
[yolov5](https://github.com/ultralytics/yolov5)로 이미지/영상에서 사람&불&건물 붕괴를 인식할 수 있도록 해봤다.

 라이브러리는 사용해봤지만, 오픈소스를 clone하여 사용해보는것은 처음이었기 때문에 requirements.txt로 환경설정하는것을 처음 해봐서 신선한 경험이었고,<br>
pytorch 튜툐리얼을 진행하던 환경에 추가로 세팅하려니 라이브러리들이 서로 버전 충돌이 나서 갈아엎으면서 진행했다.<br>
 환경세팅이 끝난 후에는 yolov5의 공식문서에서 커스텀 데이터 훈련방법을 보면서 roboflow에서 fire 데이터를 다운받고 훈련시킨 후 이미지/영상을 넣어보니 불을 잘 감지했다.
그 다음에는 사람과 건물 붕괴 데이터도 넣어서 학습해봤지만, 컴퓨터 성능문제로 훈련을 조금 밖에 돌리지 못하여 성능이 좋지 않았다.
<img src="https://github.com/KangHongJun/IPP_Xiilab/blob/main/collapse_data_train/val_batch0_pred.jpg">

#### 느낀점


## 3. [Origin-NMS](https://github.com/KangHongJun/Origin-NMS)(Sahi에 내장된 병합 알고리즘 NMS개선)

### 진행과정
sahi를 이용하여 이미지를 detect하면 오탐박스가 남는것을 개선하는것을 목표로 진행했다.
 먼저 오픈소스 [sahi](https://github.com/obss/sahi)를 detect model을 yolov5로 하여 세팅했다.
 [sahi라는 오픈소스의 목적과 문제점에 대해 파악하고 내장되어 있는 merge 알고리즘 NMS. NMM. GREEDYNMM을 하나씩 돌려보고 정리했고](https://github.com/KangHongJun/IPP_Xiilab/tree/main/sahi_improve/search) (sahi를 이용할때 겹치는 박스가 삭제되지 않거나 올바른 box까지 삭제하는 상황 개선)<br>
정리한 것을 바탕으로 피드백을 받아서 sahi의 문제점을 개선하기 위해 다음의 단계를 거쳤다.<br>
1. merge연산 진행시 IOU연산이 아닌 다른 연산을 하는 눈문에 대한 코드를 탐색해봤지만 공개한 것이 없어서 찾기 힘들었기 때문에 겹침정도를 연산하는 IOU와 IOS에 대해 이해하고 의논후에 NMS와IOS기반으로 개선해나가는것으로 방향을 잡았다.<br>
2. NMS-IOS를 진행하면 사라지는 box가 너무 많기 때문에 오리지널 box를 복구하는 방향으로 가자고 피드백을 받아 코드를 작성하고 돌려보니 box를 복구한 만큼 겹치는 부분이 많아졌기 때문에 그것을 해소할 방법이 필요했다. <br>
3. 겹치는 box를 삭제하기 위해 nms 진행시 최고score가 아닌 오리지널 box score기준으로 nms를 진행해봤지만 사소한 변화만 있었다.
4. 지금까지 돌려본 결과들을 살펴보며 고민끝에 슬라이싱 이미지의 box끼리 먼저 nms를 하고 그 다음에 오리지널 이미지의 box를 합쳐서 nms를 하는 방식으로 해보자는 피드백을 받고 진행했더니 괜찮은 결과물을 얻어낼 수 있었다.
5. 모듈화 및 도식화를 진행했다.

실제 적용 방식 dic형태로 단계 전달, 스레드의 중요성, 텐서rt, 

#### 느낀점
1. 탐색한 정보나 결과물에 대한 보고를 할때 명확하게 이해를 하거나 비교사진 등으로 듣는입장에서 판단 할 수 있는 정보로 표현해야 한다는 것과 문제해결을 위한 접근 방식 배웠다. 개선을 하기 위해 정보를 찾고, 논문에 실린 수식과 매커니즘을 정리했었는데, 그것만 가지고선 어떤 방식을 채용해야하는지 참고하기가 어려웠다.

2. 내가 지금 무엇을 하려하는지 제대로 인지해야 한다는 것을 느꼈다. 진행하면서 예제로 돌린 이미지에만 초점이 가서 핀트를 잘못 잡는 상황이 나오면서 잠깐 방황한 적이 있었기 때문에 근본적으로 지금 무엇을 하려는 건지, 왜 하는건지에 대해 명확하게 인지할 필요성을 느낄수 있었다. 

3. 코드를 개선해 나가기 위해서는 오픈소스의 구조와 가공하기 위한 반환 타입 등을 알아야 했기 때문에 처음으로 오픈소스를 디버깅하면서 분석해봤는데 어려운 만큼 코드 짜는 방식이나 문법에 대한 이해가 깊어진다고 느꼈고, 많은 도움을 받아서 진행한 만큼 누군가의 피드백을 받아가며 개선해나가는 과정이 재미있었다.

4. 코드를 개선해 나가면서 문법에 혼동이 있어서 코드를 잘못 작성한다거나, 결과 이미지 이름을 애매하게 작성하여 나중에 검토 할 때 어떤 코드에서 나온 결과물인지 모르는 상황이 나왔기 때문에 버전 관리 및 결과물에 대한 기록작성에 대한 중요성을 많이 느꼈고, sahi-yolox에 이 알고리즘을 적용해볼때는 오픈소스가 여러개 엮이니 환경세팅이 복잡했다.(pycocotools/c++기반/conda로 설치) 앞으로 문서도 꼼꼼히 읽고, 그때그때 가상환경을 구축하면서 해야겠다고 생각했다.
 
5. 생각난것을 바로 코드로 작성한다는 단점을 찾았다. 생각을 코드로 옮기고 실행하는 것은 나쁘다고 생각하지 않지만, 전후 사정을 생각해가면서 새로운 코드를 적용하기 위해 수정할 부분은 수정했어야 하고, 오류를 짐작이 아닌 디버깅을 하며 확실하게 고쳐가야하는데 그러질 않아서 시간낭비를 좀 했던것 같다. 이는 4번과 어느정도 연결되는 부분인것 같다.

6. 모듈화를 진행하면서 처음부터 모듈화를 어느정도 해놓고 돌리는것이 좋겠다고 생각했다. 이는 졸업작품할때도 생각했던 부분인데, 모듈화를 하면 리팩토링을 하게 되므로 그 과정에서 갈아엎는 경험이 었었다. 결론은 4,5번을 생각하면서 개발하자.

 
 <p float="left">
    <div align = "center">
       <img src="https://github.com/KangHongJun/Origin-NMS/blob/main/Images/NMS_yolov5m.png"><br>
     [ sahi를 이용한 이미지 detect 후 NMS ]<br><br>
       <img src="https://github.com/KangHongJun/Origin-NMS/blob/main/Images/Origin_NMS_yolov5m.png"><br>
     [ 개선한 방법 ]
    </div>
  </p>
  기존 NMS와 비교하면 상당히 개선된 것을 확인할 수 있다.

### 3.1 [Tuning_Threshold](https://github.com/KangHongJun/Tuning_Threshold)

#### 진행과정
1. Origin-NMS가 테스트에서 성능이 별로였기 때문에 포함도 기준으로 IOU를 구하여 merge하는 알고리즘 이후에 남은 데이터끼리 NMS처리하는 IIOU를 전달받았다.
2. IIOU에서 가장 큰 사람이 탐지 되지 않았기 때문에 로그를 보면서 어느 단계에서 merge되는지 파악했고, threshold를 조정하면서 알고리즘의 성능을 향상시켰다.
3. F1-Score를 구하여 수치로 각 알고리즘들의 성능을 검증 및 분석했다.

##### 느낀점
1. yolov5, yolox두가지 환경에서 테스트를 진행하다보니 같은 threshold여도 결과가 조금씩 달라서<br>
   같이 테스트하기 보다는 한가지 환경에서 먼저 마무리 하는 것이 좋겠다 생각했다.
2. 예전에 threshold수치를 조정해봤을 때는 별 성과가 없었는데 의미가 있다는 것을 체험했다.
3. F1-Score를 구하는 코드를 짜면서 Precision, Recall과 TP,FP,FN등 성능 검증에 사용되는 개념에 대해 알아갈수 있었다.


